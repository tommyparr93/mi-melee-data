{% extends 'base.html' %}
{% block title %}PR H2H Table{% endblock %}
{% block content %}

<style>
    .sticky-col {
        position: sticky;
        left: 0;
        z-index: 2;
        background-color: #f8f9fa !important;
        border-right: 2px solid #dee2e6;
        font-weight: bold;
    }
    .sticky-header th {
        position: sticky;
        top: 0;
        z-index: 3;
        background-color: #f8f9fa;
        border-bottom: 2px solid #dee2e6;
    }
    .fixed-column {
        min-width: 80px;
        text-align: center;
        vertical-align: middle !important;
    }
    /* Cell Coloring Logic */
    .cell-win { background-color: #d4edda !important; } /* Success */
    .cell-loss { background-color: #f8d7da !important; } /* Danger */
    .cell-even { background-color: #d1ecf1 !important; } /* Info */
    .cell-none { color: #ced4da; } /* Gray out unplayed matches */
</style>

<div class="table-responsive" style="overflow-y: auto; max-height: 92vh;">
    <table class="table table-sm table-bordered" style="font-size: 13px;">
        <thead class="sticky-header">
            <tr>
                <th class="sticky-col">Winner \ Loser</th>
                {% for player in players %}
                    <th class="fixed-column">
                        <a href="{% url 'player_detail' pk=player.pk %}?pr_view=on&pr_season={{ active_pr_season }}">
                    {{ player.name }}
                </a>
                    </th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in table_data %}
                <tr>
                    <td class="sticky-col">
                        <a href="{% url 'player_detail' pk=row.player_obj.pk %}?pr_view=on&pr_season={{ active_pr_season }}">{{ row.player_name }}</a>
                    </td>
                    {% for cell in row.opponents %}
                        <td class="fixed-column
                            {% if cell.is_diag %}table-dark
                            {% elif not cell.played %}cell-none
                            {% elif cell.wins > cell.losses %}cell-win
                            {% elif cell.wins < cell.losses %}cell-loss
                            {% else %}cell-even{% endif %}">

                            {% if cell.is_diag %}
                                â€”
                            {% elif not cell.played %}
                                0-0
                            {% else %}
                                <b>{{ cell.wins }}-{{ cell.losses }}</b>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}